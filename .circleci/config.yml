version: 2
jobs:
  default:
    docker:
      - image: circleci/golang:1.8
        environment:
          # TODO: CircleCI is currently making all authentication attempts pass, regardless of password
          POSTGRESQL_PASSWORD: abc1243
      - image: circleci/postgres:9.5-alpine
        environment:
          POSTGRES_PASSWORD: abc123
      - image: circleci/mysql:5.7
        environment:
          MYSQL_ALLOW_EMPTY_PASSWORD: yes

    working_directory: /go/src/github.com/alphagov/paas-rds-broker
    steps:
      - checkout
      - run: go get -u github.com/onsi/ginkgo/ginkgo
      - run: ginkgo -r --skipPackage=ci
  postgres-10:
    docker:
      - image: circleci/golang:1.8
        environment:
          # TODO: CircleCI is currently making all authentication attempts pass, regardless of password
          POSTGRESQL_PASSWORD: abc1243
      - image: circleci/postgres:10.5-alpine
        environment:
          POSTGRES_USER: postgres
          POSTGRES_DB: postgres
          POSTGRES_PASSWORD: abc123
      - image: circleci/mysql:5.7
        environment:
          MYSQL_ALLOW_EMPTY_PASSWORD: yes

    working_directory: /go/src/github.com/alphagov/paas-rds-broker
    steps:
      - checkout
      - run: go get -u github.com/onsi/ginkgo/ginkgo
      - run: ginkgo -r --skipPackage=ci
workflows:
  version: 2
  all_db_versions:
    jobs:
      - default
      - postgres-10
